
# Virtual Host configuration for everydayprojobs.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
server {
   listen 80;
   server_name everydayprojobs.com api.everydayprojobs.com;

   location / {
     # Redirect any http request to https
     return 301 https://$server_name$request_uri;
   }
}

server {
        #listen 80;
	#listen [::]:80; 
        listen 443 ssl;

	server_name everydayprojobs.com;

        ssl_certificate /etc/letsencrypt/live/everydayprojobs.com/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/everydayprojobs.com/privkey.pem;
        
        location /.well-known/acme-challenge{
           root /var/www/letsencrypt;
        }

        location /assets/(img|libs) {
           sendfile on;
           sendfile_max_chunk 2m;
           tcp_nopush on;
           root /home/ubuntu/apps/app;
        } 

        location /blog/{
          # proxy_set_header Host $host;
          # proxy_set_header X-Real-IP $remote_addr;
          # proxy_set_header Host https://everydayprojobs.github.io;
           proxy_pass http://everydayprojobs.github.io/;
          # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

	location / {
              proxy_pass http://127.0.0.1:3000;
              proxy_http_version 1.1;
              proxy_set_header Upgrade $http_upgrade;
              proxy_set_header Connection 'upgrade';
              proxy_set_header Host $host;
              proxy_cache_bypass $http_upgrade;
	}
}
server{
      #listen 80;
      #listen [::]:80;
      listen 443 ssl;

      ssl_certificate /etc/letsencrypt/live/everydayprojobs.com/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/everydayprojobs.com/privkey.pem;


      server_name api.everydayprojobs.com;
    
      location /.well-known/acme-challenge{
         root /var/www/letsencrypt;
      }

      location /assets/(img|libs){
        sendfile on;
        sendfile_max_chunk 2m;
        tcp_nopush on;
        root /home/ubuntu/apps/api;
     }

      location / {
          proxy_pass http://127.0.0.1:3002;
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection 'upgrade';
          proxy_set_header Host $host;
          proxy_cache_bypass $http_upgrade;
      }
}
